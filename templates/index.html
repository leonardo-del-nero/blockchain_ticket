<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLockchain</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="api-container">
        <h1>Bem-vindo à API da Blockchain!</h1>
        <p>Explore os endpoints disponíveis para interagir com a blockchain.</p>

        <div class="interaction-section">
            <h2>Testar a API</h2>
            
            <label for="json-input"><strong>Payload da Transação (JSON):</strong></label>
            <textarea id="json-input" placeholder='{&#10;    "sender": "seu-endereco",&#10;    "receiver": "endereco-destinatario",&#10;    "amount": 10&#10;}'></textarea>

            <div class="action-buttons">
                <button onclick="fetchAPI('/get_chain', 'GET')"><span class="method method-get">GET</span> /get_chain</button>
                <button onclick="fetchAPI('/mine_block', 'GET')"><span class="method method-get">GET</span> /mine_block</button>
                <button onclick="fetchAPI('/is_valid', 'GET')"><span class="method method-get">GET</span> /is_valid</button>
                <button id="post-btn" onclick="addTransaction()"><span class="method method-post">POST</span> /add_transaction</button>
            </div>

            <h3>Resposta da API:</h3>
            <pre id="api-response">A resposta da sua requisição aparecerá aqui...</pre>
        </div>
    </div>

    <script>
        /**
         * Função genérica para fazer requisições à API.
         * @param {string} endpoint - O endpoint da API a ser chamado.
         * @param {string} method - O método HTTP (GET, POST, etc.).
         * @param {object} body - O corpo da requisição (para métodos como POST).
         */
        async function fetchAPI(endpoint, method, body = null) {
            const responseContainer = document.getElementById('api-response');
            responseContainer.textContent = 'Carregando...';

            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(endpoint, options);
                const data = await response.json();

                // Formata o JSON para exibição bonita
                responseContainer.textContent = JSON.stringify(data, null, 4);

            } catch (error) {
                console.error('Erro ao fazer a requisição:', error);
                responseContainer.textContent = `Erro na requisição: ${error.message}`;
            }
        }

        /**
         * Função específica para adicionar uma nova transação.
         * Ela lê o conteúdo do textarea, valida o JSON e envia para a API.
         */
        function addTransaction() {
            const jsonInput = document.getElementById('json-input').value;
            const responseContainer = document.getElementById('api-response');
            
            if (!jsonInput.trim()) {
                responseContainer.textContent = 'Erro: O campo de payload JSON não pode estar vazio.';
                return;
            }

            try {
                const transactionData = JSON.parse(jsonInput);
                fetchAPI('/add_transaction', 'POST', { transactions: [transactionData] });
            } catch (error) {
                console.error('Erro ao parsear JSON:', error);
                responseContainer.textContent = `Erro: JSON inválido. Verifique a sintaxe.\n\nDetalhes: ${error.message}`;
            }
        }
    </script>
</body>
</html>
